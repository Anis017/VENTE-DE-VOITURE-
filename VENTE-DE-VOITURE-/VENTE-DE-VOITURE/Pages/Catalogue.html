<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catalogue - AutoMarket</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="../index.html" class="logo">
                <span class="logo-icon">üöó</span>
                <span>AutoMarket</span>
            </a>
            
            <div class="search-box-nav">
                <input type="text" id="quick-search" placeholder="Rechercher...">
                <button onclick="quickSearch()">üîç</button>
            </div>
            
            <ul class="nav-links">
                <li><a href="../index.html">Accueil</a></li>
                <li><a href="Catalogue.html" class="active">Catalogue</a></li>
                <li><a href="vente.html">Vendre/Louer</a></li>
                <li><a href="profile.html">Mon Compte</a></li>
            </ul>
        </div>
    </nav>

    <main class="main-content">
        <div class="container">
            <h1 class="section-title">Catalogue de v√©hicules</h1>
            
            <!-- Filtres de recherche -->
            <div class="filters-container">
                <h3>Filtres de recherche</h3>
                <form id="filters-form">
                    <div class="filters-grid">
                        <div class="form-group">
                            <label for="marque">Marque</label>
                            <select id="marque" name="marque" class="form-control">
                                <option value="">Toutes les marques</option>
                                <option value="Peugeot">Peugeot</option>
                                <option value="Renault">Renault</option>
                                <option value="Citro√´n">Citro√´n</option>
                                <option value="Tesla">Tesla</option>
                                <option value="BMW">BMW</option>
                                <option value="Mercedes">Mercedes</option>
                                <option value="Audi">Audi</option>
                                <option value="Volkswagen">Volkswagen</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="type_consommation">Type de carburant</label>
                            <select id="type_consommation" name="type_consommation" class="form-control">
                                <option value="">Tous</option>
                                <option value="essence">Essence</option>
                                <option value="diesel">Diesel</option>
                                <option value="electrique">√âlectrique</option>
                                <option value="hybride">Hybride</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="min_price">Prix minimum</label>
                            <input type="number" id="min_price" name="min_price" class="form-control" placeholder="0" min="0">
                        </div>
                        
                        <div class="form-group">
                            <label for="max_price">Prix maximum</label>
                            <input type="number" id="max_price" name="max_price" class="form-control" placeholder="100000" min="0">
                        </div>
                        
                        <div class="form-group">
                            <label for="min_year">Ann√©e minimale</label>
                            <input type="number" id="min_year" name="min_year" class="form-control" placeholder="2015" min="1990" max="2025">
                        </div>
                        
                        <div class="form-group">
                            <label for="max_km">Kilom√©trage maximum</label>
                            <input type="number" id="max_km" name="max_km" class="form-control" placeholder="100000" min="0">
                        </div>
                    </div>
                    
                    <div class="form-group mt-2">
                        <label style="display: flex; align-items: center; gap: 1rem;">
                            <input type="checkbox" name="disponible_vente" id="disponible_vente" style="width: auto;">
                            V√©hicules √† vendre uniquement
                        </label>
                        <label style="display: flex; align-items: center; gap: 1rem;">
                            <input type="checkbox" name="disponible_location" id="disponible_location" style="width: auto;">
                            V√©hicules en location uniquement
                        </label>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                        <button type="button" onclick="applyFilters()" class="btn btn-primary">Rechercher</button>
                        <button type="button" onclick="resetFilters()" class="btn btn-outline">R√©initialiser</button>
                    </div>
                </form>
            </div>
            
            <!-- Barre d'outils -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin: 2rem 0;">
                <div>
                    <span id="results-count">Chargement...</span>
                </div>
                <div style="display: flex; gap: 1rem; align-items: center;">
                    <label for="sort-select">Trier par:</label>
                    <select id="sort-select" class="form-control" style="width: auto;">
                        <option value="date-desc">Plus r√©cent</option>
                        <option value="price-asc">Prix croissant</option>
                        <option value="price-desc">Prix d√©croissant</option>
                        <option value="km-asc">Kilom√©trage croissant</option>
                        <option value="year-desc">Ann√©e d√©croissante</option>
                    </select>
                </div>
            </div>
            
            <!-- Grille de v√©hicules -->
            <div class="vehicles-grid" id="vehicles-grid">
                <div class="loading">Chargement des v√©hicules...</div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <div>
                <h3>AutoMarket</h3>
                <p>Votre plateforme de confiance pour l'achat et la location de v√©hicules.</p>
            </div>
            
            <div>
                <h3>Liens rapides</h3>
                <ul>
                    <li><a href="Catalogue.html">Catalogue</a></li>
                    <li><a href="vente.html">Vendre</a></li>
                    <li><a href="Contact.html">Contact</a></li>
                </ul>
            </div>
        </div>
        
        <div class="footer-bottom">
            <p>&copy; 2025 AutoMarket. Tous droits r√©serv√©s.</p>
        </div>
    </footer>

    <script src="../js/main.js"></script>
    <script>
        let allVehicles = [];
        
        // Charger tous les v√©hicules au chargement de la page
        document.addEventListener('DOMContentLoaded', function() {
            loadVehicles();
            
            // Appliquer les filtres depuis l'URL si pr√©sents
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.toString()) {
                applyFiltersFromURL();
            }
        });
        
        function loadVehicles() {
            fetch('../php/get_vehicles.php?limit=100')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        allVehicles = data.vehicles;
                        displayVehicles(allVehicles);
                        updateResultsCount(allVehicles.length);
                    } else {
                        document.getElementById('vehicles-grid').innerHTML = 
                            '<p class="text-center">Erreur lors du chargement des v√©hicules.</p>';
                    }
                })
                .catch(error => {
                    console.error('Erreur:', error);
                    document.getElementById('vehicles-grid').innerHTML = 
                        '<p class="text-center">Erreur lors du chargement des v√©hicules.</p>';
                });
        }
        
        function displayVehicles(vehicles) {
            const grid = document.getElementById('vehicles-grid');
            
            if (vehicles.length === 0) {
                grid.innerHTML = '<p class="text-center">Aucun v√©hicule trouv√© avec ces crit√®res.</p>';
                return;
            }
            
            grid.innerHTML = '';
            
            vehicles.forEach(vehicle => {
                const card = createVehicleCard(vehicle);
                grid.appendChild(card);
            });
        }
        
        function createVehicleCard(vehicle) {
            const card = document.createElement('div');
            card.className = 'vehicle-card';
            card.dataset.brand = vehicle.marque;
            card.dataset.model = vehicle.modele;
            card.dataset.price = vehicle.prix_vente || vehicle.prix_location_jour || 0;
            card.dataset.km = vehicle.kilometrage;
            card.dataset.year = vehicle.annee;
            
            const imageUrl = vehicle.image_principale || '../images/default-car.jpg';
            let price = '';
            
            if (vehicle.disponible_vente && vehicle.prix_vente) {
                price = vehicleApp.formatPrice(vehicle.prix_vente);
            } else if (vehicle.disponible_location && vehicle.prix_location_jour) {
                price = vehicleApp.formatPrice(vehicle.prix_location_jour) + '/jour';
            }
            
            card.innerHTML = `
                <div style="position: relative;">
                    <img src="${imageUrl}" alt="${vehicle.marque} ${vehicle.modele}" class="vehicle-image" 
                         onclick="window.location.href='detailCar.html?id=${vehicle.id}'">
                    <button class="favorite-btn" onclick="vehicleApp.toggleFavorite(${vehicle.id}); event.stopPropagation();" 
                            style="position: absolute; top: 10px; right: 10px; background: white; border: none; 
                                   border-radius: 50%; width: 40px; height: 40px; cursor: pointer; font-size: 1.5rem;">
                        ü§ç
                    </button>
                </div>
                <div class="vehicle-info" onclick="window.location.href='detailCar.html?id=${vehicle.id}'" style="cursor: pointer;">
                    <div class="vehicle-brand">${vehicle.marque}</div>
                    <h3 class="vehicle-model">${vehicle.modele}</h3>
                    <div class="vehicle-price">${price}</div>
                    <div class="vehicle-details">
                        <span>üìÖ ${vehicle.annee}</span>
                        <span>üõ£Ô∏è ${vehicle.kilometrage.toLocaleString()} km</span>
                        <span>‚õΩ ${vehicle.consommation} L</span>
                    </div>
                    <div class="vehicle-details">
                        <span>üöÄ ${vehicle.vitesse_max} km/h</span>
                        <span>üé® ${vehicle.couleur}</span>
                    </div>
                    <div class="vehicle-badges">
                        ${vehicle.disponible_vente ? '<span class="badge badge-sale">√Ä vendre</span>' : ''}
                        ${vehicle.disponible_location ? '<span class="badge badge-rent">Location</span>' : ''}
                    </div>
                    <button onclick="vehicleApp.addToComparison(${vehicle.id}); event.stopPropagation();" 
                            class="btn btn-outline" style="margin-top: 1rem; width: 100%; padding: 0.5rem;">
                        Comparer
                    </button>
                </div>
            `;
            
            return card;
        }
        
        function applyFilters() {
            const marque = document.getElementById('marque').value;
            const typeConsommation = document.getElementById('type_consommation').value;
            const minPrice = parseFloat(document.getElementById('min_price').value) || 0;
            const maxPrice = parseFloat(document.getElementById('max_price').value) || Infinity;
            const minYear = parseInt(document.getElementById('min_year').value) || 0;
            const maxKm = parseInt(document.getElementById('max_km').value) || Infinity;
            const disponibleVente = document.getElementById('disponible_vente').checked;
            const disponibleLocation = document.getElementById('disponible_location').checked;
            
            let filtered = allVehicles.filter(vehicle => {
                // Filtre marque
                if (marque && vehicle.marque !== marque) return false;
                
                // Filtre type de carburant
                if (typeConsommation && vehicle.type_consommation !== typeConsommation) return false;
                
                // Filtre prix
                const price = vehicle.prix_vente || vehicle.prix_location_jour || 0;
                if (price < minPrice || price > maxPrice) return false;
                
                // Filtre ann√©e
                if (vehicle.annee < minYear) return false;
                
                // Filtre kilom√©trage
                if (vehicle.kilometrage > maxKm) return false;
                
                // Filtre disponibilit√© vente
                if (disponibleVente && !vehicle.disponible_vente) return false;
                
                // Filtre disponibilit√© location
                if (disponibleLocation && !vehicle.disponible_location) return false;
                
                return true;
            });
            
            displayVehicles(filtered);
            updateResultsCount(filtered.length);
        }
        
        function resetFilters() {
            document.getElementById('filters-form').reset();
            displayVehicles(allVehicles);
            updateResultsCount(allVehicles.length);
        }
        
        function quickSearch() {
            const searchTerm = document.getElementById('quick-search').value.toLowerCase();
            
            let filtered = allVehicles.filter(vehicle => {
                return vehicle.marque.toLowerCase().includes(searchTerm) ||
                       vehicle.modele.toLowerCase().includes(searchTerm) ||
                       (vehicle.description && vehicle.description.toLowerCase().includes(searchTerm));
            });
            
            displayVehicles(filtered);
            updateResultsCount(filtered.length);
        }
        
        function updateResultsCount(count) {
            document.getElementById('results-count').textContent = 
                `${count} v√©hicule${count > 1 ? 's' : ''} trouv√©${count > 1 ? 's' : ''}`;
        }
        
        function applyFiltersFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            
            if (urlParams.has('marque')) {
                document.getElementById('marque').value = urlParams.get('marque');
            }
            if (urlParams.has('type_consommation')) {
                document.getElementById('type_consommation').value = urlParams.get('type_consommation');
            }
            
            // Appliquer les filtres une fois les v√©hicules charg√©s
            setTimeout(() => {
                applyFilters();
            }, 500);
        }
        
        // Tri des v√©hicules
        document.getElementById('sort-select').addEventListener('change', function() {
            const criteria = this.value;
            vehicleApp.sortVehicles(criteria);
        });
    </script>
</body>
</html>
